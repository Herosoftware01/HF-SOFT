
{% extends 'mains.html' %}
{% load static %}

{% block content %}
<meta http-equiv="Cache-Control" content="no-store" />

<div class="bg-[url('{% static 'images/blue.jpg' %}')] relative bg-cover bg-center min-h-screen text-white">
    <div class="absolute inset-0 bg-gradient-to-br from-indigo-900/80 to-purple-800/70 backdrop-blur-sm"></div>

    <div class="relative z-10 flex flex-col justify-center items-center min-h-screen text-center px-4">
        <h1 class="text-5xl font-bold mb-4">☕ Break Time</h1>
        <p class="text-lg mb-4">Take a short break! You'll be redirected once the break ends.</p>

        <div class="text-2xl font-semibold mt-4" id="countdown">
            Time left: <span id="timer">--:--</span>
        </div>
    </div>
</div>

<script>
    // Pass server timestamps from Django
    const breakEnd = {{ break_end_ts }};
    const serverNow = {{ server_now_ts }};

    // Calculate difference between client and server time
    const clientNow = new Date().getTime();
    const offset = clientNow - serverNow;

    function updateTimer() {
        const now = new Date().getTime();
        const correctedNow = now - offset;
        const timeLeft = breakEnd - correctedNow;

        if (timeLeft <= 0) {
            console.log("✅ Break ended. Redirecting...");

            // Redirect to original URL stored in sessionStorage or fallback
            // const originalUrl = sessionStorage.getItem('original_url') || '/roll/';
            const originalUrl = sessionStorage.getItem('original_url') || '/';
            window.location.href = originalUrl;
        } else {
            const mins = Math.floor((timeLeft / 1000 / 60) % 60);
            const secs = Math.floor((timeLeft / 1000) % 60);
            document.getElementById("timer").textContent =
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
    }

    setInterval(updateTimer, 1000);
    updateTimer();
</script>
{% endblock %}
